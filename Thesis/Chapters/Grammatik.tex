% Chapter Template

\chapter{Entwicklung einer Definitionssprache für Regeln} % Main chapter title

\label{GrammatikKapitel} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

\lhead{Chapter 4. \emph{Grammatik}} % Change X to a consecutive number; this is for the header on each page - perhaps a shortened title

In diesem Kapitel wird die Grammatik vorgestellt, die es ermöglichen soll, Regeln innerhalb von Prozessinstanzen aber auch Instanzübergreifend zu definieren. Zuerst muss geklärt werden, welche Anforderungen an die Grammatik gestellt werden und welche Fragen auftauchen. Im zweiten Teil wird die Syntax und Semantik der Grammatik erläutert. Schließlich wird aufgezeigt, wie die vorgestellten Regeln aus Kapitel \ref{sec:exampleconstraints} mithilfe der zuvor definierten Grammatik beschrieben werden können.

%
% Anforderungen an die Grammatik
%
\section{Anforderungen an die Grammatik}
Um eine Grammatik zu definieren, die möglichst viele Fälle abdeckt, muss zuerst untersucht werden, welche genauen Anforderungen an sie gestellt werden.

Grundsätzlich ist das Ziel, Regeln zur Ausführung bestimmter Aktivitäten auf Basis bereits abgeschlossener Aktivitäten aufzustellen. Es muss also einen Teil geben, in dem man die Bedingungen festlegen kann um dann anzugeben, welche gewünschte Aktion daraus resultiert. Die Bedingungen bilden in den meisten Fällen eine Konjunktion. Werden alle Bedingungen erfüllt, tritt die Regel in Kraft. Zur Vollständigkeit wird hier auch die Option mit aufgenommen, absolute Regeln ohne Bedingungen aufzustellen, die in jedem Fall gelten sollen.

Für alle Regeltypen, die in \ref{sec:ArtenConstraints} gefunden wurden, ist Konjunktion von positiven Bedingungen ausreichend. Um dem Nutzer größtmögliche Freiheit zu lassen, sollte Disjunktion und Negation von Bedingungen ebenfalls angeboten werden.

Das Ziel der Arbeit ist es, Regeln in Instanz-übergreifendem Kontext aufstellen zu können. Trotzdem muss es auch möglich sein, Regeln wie in bisherigen Compliancecheckern auch innerhalb einer Instanz zu prüfen. Es ist deswegen eine eindeutige Konvention notwendig, die deutlich macht, in welchem Kontext die Regel arbeitet.

Im Rollenbasierten Authorisierungsmodell existiert das einfache Rollenmodell, in welchem dem Nutzer nur die Rollen zur Verfügung stehen, die ihm explizit zugewiesen wurden. Es gibt keine eindeutig festgelegten Hierarchien zwischen den Rollen. Im hierarchischen Rollenmodell hingegen kann ein Nutzer jede Rolle annehmen, die gleich oder unter der ihm zugewiesenen Rolle steht. Die Grammatik sollte beide Modelle behandeln können.

Da es Bedingungen in Bezug auf Zeitpunkte, Zeitunterschiede und Werte von Attributen gibt, müssen zumindest grundlegende arithmetische Operationen erlaubt sein.

Eventlogs speichern zu jeder Aktivität jedes einzelne Event. Das könnte entweder die Eingabe der Regeln unnötig kompliziert machen (indem der Anwender zu jeder einzelnen Aktivität immer das Event angeben muss) oder es würde zu multiplen Ergebnissen führen. Es muss eine Einigung geben, ob Events explizit angegeben werden müssen, oder sich Prädikate wie \texttt{timestamp(TASK)} auf ein konkretes Event bezieht.

Unter Berücksichtigung aller gestellten Forderungen sollte trotzdem eine leicht zu lernende und leicht zu verstehende Notation gewährleistet sein. Im folgenden wird die entwickelte Grammatik vorgestellt und gleichzeitig geklärt, inwiefern die hier aufgeführten Fragen und Anforderungen gelöst werden.
%
% Definition der Grammatik
%
\section{Definition der Grammatik}
Für ein besseres Verständnis der Definition wird hier zuerst ein kleines, intuitiv zu verstehendes Beispiel aufgezeigt (Abb. \ref{fig:demorulefile}). Am Anfang wird spezifiziert, dass Mark Maier und Max Mueller Verwandte sind. In der nächsten Zeile wird die Regel aufgestellt, dass Verwandte nicht gemeinsam and den Aktivitäten 'Kredit beantragen' und 'Kredit prüfen' arbeiten dürfen. Sollte Mark Maier den Kredit beantragt haben, wird Max Mueller die Prüfung des Kredits untersagt.\\

\begin{verbatim}
SET 'Mark Maier' is related to 'Max Mueller'

DESC "'Kredit beantragen' und 'Kredit prüfen' dürfen 
	nicht von Verwandten ausgeführt werden"
IF user USER_A executed 'Kredit beantragen' AND USER_A is related to USER_B
  THEN user USER_B cannot execute 'Kredit prüfen'
\end{verbatim}
\begin{figure}[!h]
\caption{Beispiel Spezifikation einer einfachen Regel}
\label{fig:demorulefile}
\end{figure}


Das Ziel der Grammatik ist es, gewünschte oder unerwünscht Aktionen in Abhängigkeit von zuvor stattgefundenen Aktivitäten zu definieren. Zu diesem Zweck werden die Bedingungen als eine Konjunktion von Prädikaten über den Verlauf gebildet. Sollten diese Aussagen alle zu einem positiven Ergebnis führen, tritt die Einschränkung in Kraft. Diese Einschränkung macht eine Aussage darüber, ob eine bestimmte Aktivität von einem Nutzer / Rolle ausgeführt werden muss bzw dass sie von einem Nutzer/Rolle nicht ausgeführt werden darf. Es gibt auch Regeln, die aufzeigen, wann ein Verlauf nicht der Spezifikation entsprach (\texttt{illegal\_execution}).\\
In den nächsten Abschnitten werden zuerst die Variablen, Konstanten und Prädikate vorgestellt, bevor dann im Anschluss die Syntax und Semantik der Grammatik genauer erläutert wird.

\subsection{Argumente - Variablen und Konstanten}
\label{sec:vars}

Prädikate sind Aussagen über Parameter einer Aktivität oder über Beziehungen zwischen Rollen oder Nutzern. Außer dem Prädikat \texttt{illegal execution} muss jedem mindestens ein Argument übergeben werden. Die Argumente sind entweder Variablen oder Konstanten in Form einer Zeichenkette oder einem numerischen Wert. Der Typ des Argumentes wird in der Grammatik nicht explizit deklariert, sondern erschließt sich aus dem Kontext des jeweiligen Prädikates. In diesem Abschnitt werden alle verwendbaren Typen vorgestellt. Sollte ein Argument als Variable übergeben werden, beginnt das Argument für jeden Typ mit einem Großbuchstaben. Die Form der Konstanten hängt von dem entsprechenden Typ ab. Grundsätzlich gilt, dass alle Typen außer den Zeiten und numerischen Werten einen String als Konstante haben, der mit einfachen Anführungszeichen umschlossen sein muss. Innerhalb der Anführungszeichen sind alle Zeichen erlaubt.

\begin{table}[h]
\begin{tabular} {|p{2cm}|p{13cm}|}
\hline
\textbf{Typ}&\textbf{Beschreibung}\\
\hline
UT& Variablen und Konstanten über Nutzer. Als Konstante sind Nutzer ein String.\\
\hline
RT& Variablen und Konstanten über Rollen. Als Konstante sind Rollen ein String.\\
\hline
TT& Variablen und Konstanten über Aktivitäten. Als Konstante sind Aktivitäten ein String.\\
\hline
WT& Variablen und Konstanten über Prozesse. Dieser Typ bezeichnet das Prozessschema. Als Konstante sind Prozesse ein String.\\
\hline
WIT& Variablen und Konstanten über Prozessinstanzen. Als Konstante sind Prozessinstanzen ein String.\\
\hline
ET&  Variablen und Konstanten über Eventtypen. Als Konstante sind Events Elemente aus der Menge $\{$'started', 'completed',..$\}$ (siehe \ref{sec:activities}).\\
\hline
TP& Variablen und Konstanten über Zeitpunkte. Als Konstante Zeitpunkt nach ISO 8601.\\
\hline
TS& Variablen und Konstanten über Zeitspannen. Als Konstante Zeitspanne nach ISO 8601.\\
\hline
NT&  Variablen und Konstanten über numerische Werte. Als Konstante sind numerische Werte eine Zahl größer Null. Negative Werte sind nicht erlaubt.\\
\hline
\end{tabular}
\caption{Argument Typen, die bei Prädikaten vorkommen können}
\label{tab:args}
\end{table}

Zeitpunkte nach ISO 8601 werden im Format JJJJ-MM-DD'T'hh:mm:ss.f , wobei f ein dezimaler Bruchteil für Sekunden beliebiger Genauigkeit ist. Die Datums und Uhrzeit-Angabe wird von einem 'T' getrennt. Die Werte werden ohne Leerzeichen notiert. Es ist erlaubt, Werte mit geringerer Genauigkeit anzugeben, jedoch darf die Angabe immer nur von rechts (mit dem kleinsten Wert beginnend) weggelassen werden. Gültige Beispiele sind \texttt{2015-08-21T11:23:45.23526} , \texttt{2015-08-21T11}, \texttt{2015-08}. Eine ungültige Angabe hingegen wäre \texttt{2015-21T23}. Hier wurde der Monat und die Uhrzeit weggelassen, obwohl dahinter noch das Datum und die Minuten standen.

Zeitspannen im ISO 8601 Format sind 'P'JJJJ'Y'MM'M'DD'D''T'hh'h'mm'm'ss.f's'. Die Zeitspanne beginnt mit einem vorangestellten 'P', dahinter folgen Werte für Jahr, Monat, Tag, Stunden, Minuten, Sekunden. Datum und Zeitangaben werden hier ebenfalls voneinander mit dem Trennsymbol 'T' abgegrenzt. Im ISO 8601 sind auch Wochenangaben erlaubt. Da diese sich aber auch durch Monate und Tage darstellen lassen, wird hier darauf verzichtet. Bei Zeitspannen dürfen auch Werte in der "Mitte" weggelassen werden. Um trotzdem eindeutig identifizieren zu können, welche Einheit eine Angabe besitzt, muss hinter jedem Wert das zugehörige Symbol stehen: \textbf{Y} für Jahr, \textbf{M} Monat, \textbf{D} Tage, \textbf{h} Stungen, \textbf{m} Minuten, \textbf{s} Sekunden. Beispiele für Zeitspannen sind \texttt{P2Y6M1DT16h35m2s} (2 Jahre 6 Monate 1 Tag 16 Stunden 35 Minuten 2 Sekunden), \texttt{P1D} (1 Tag) und \texttt{P2Y1DT16h35m2s} (2 Jahre 1 Tag 16 Stunden 35 Minuten 2 Sekunden).

Zeitzonenangaben sind nicht erlaubt.

\subsection{Prädikate}
In diesem Abschnitt werden alle Verfügbaren Prädikate vorgestellt. Es gibt  7 verschiedene Typen: \textit{Externe Informationen, Spezifikation des Prozesses und der Authorisierung, Status, Prädikate für den Kopf einer Regel, Aggregationsprädikate, Vergleiche und arithmetische Operationen}. \\

Eine genaue Auflistung aller Prädikate befindet sich in Anhang {\ref{AppendixA}}.

Externe Informationen (Tabelle \ref{tab:extern}) sind Aussagen, die nicht direkt mit der Workflow Spezifikation zu tun haben aber dennoch relevant für den Ablauf sein könnten. Diese Prädikate müssen explizit in den Regeln gesetzt werden, da sie nicht aus den Logs herausgelesen werden und bei einer Anfrage immer \textit{false} zurückgeben würden.


Spezifikationsprädikate (Tabelle \ref{tab:specification}) bestimmen die Beziehungen und Zugehörigkeit zwischen Nutzern, Rollen und Tasks. Um korrekte Ergebnisse zu erhalten, sollten sie genauso gesetzt werden wie in der Spezifikation der Authorisierung zur Ausführungszeit des Prozesses.


Statusprädikate (Tabelle \ref{tab:status}) sind Aussagen über Aktivitäten. Diese können in den Bedingungen einer Regel eingesetzt werden und werden später mit den Informationen aus den Logs verglichen. 


Aggregations Prädikate (Tabelle \ref{tab:conditional}) (\textit{NUMBER, SUM, AVG, MIN, MAX}) geben einen Wert über die Aggregation von einer Variablen zurück, die in den Klauseln des Körpers dieses Prädikates stehen. \texttt{MIN OF X WHERE 'T1' completed AND timestamp of 'T1' is X IS N} berechnet das Minimum von allen Zeitpunkten, an denen die Aktivität 'T1' abgeschlossen wurde und schreibt es in die Variable N. X ist die Variable, mit der gerechnet wird und mindestens ein Mal in Körper dieses Prädikates vorkommen muss. Die beiden Literale \texttt{'T1' completed} und \texttt{timestamp of 'T1' is X} bilden den Körper. '\texttt{MIN OF} Var \texttt{WHERE} body \texttt{IS} Var ist das Aggregations-Prädikat selbst.



Vergleiche (Tabelle \ref{tab:comparison}) dienen dazu, festzustellen, in welchem Verhältnis zwei Werte zueinander stehen. Es können immer nur zwei Werte des gleichen Typs verglichen werden. Bei Gleichheitsabfragen sind alle Typen erlaubt, bei Abfragen über Größenverhätltnisse sind außer den numerischen Werten und Zeiten auch Rollen bezüglich der Hierarchie erlaubt.


Arithmetische Operationen (Tabelle \ref{tab:operations}) sind grundsätzlich nur für numerische Werte möglich. Eine Ausnahme bildet die Summe aus einem Zeitpunkt und einer Zeitspanne (Das Ergebnis ist ein Zeitpunkt) und die Differenz aus zwei Zeitpunkten (das Ergebnis ist eine Zeitspanne). Jede einzelne arithmetische Operation muss in Klammern stehen.

Kopfprädikate bestimmen das gewünschte Resultat einer Regel. Sie machen Aussagen darüber, ob eine Aktivität von einem Nutzer/Rolle ausgeführt werden darf oder muss. Diese müssen im Kopf einer Regel stehen, und dürfen nicht im Körper vorkommen. \texttt{illegal execution} kann dazu verwendet werden, eine Ausführung als regelwidrig zu kennzeichnen, sofern die Spezifikation im Körper der Regel erfüllt wurde. (Tabelle \ref{tab:head})




\subsection{Regeln}

Eine Regel besteht aus einem Körper, der die Bedingungen enthält (eingeleitet durch das Schlüsselwort 'IF') und einem Kopf (nach dem Schlüsselwort 'THEN'):
\begin{verbatim}
IF body THEN head
\end{verbatim}

Sei\\
\textbf{L} := $\{P_1,P_2,...,P_n\},\ n\in\mathbb{N}$ die Menge aller zuvor definierter Prädikate außer den Kopfprädikaten,\\
\textbf{K} := $\{K_1\ OR\ K_2\ OR\ ...\ OR\ K_m\},\ m \in \mathbb{N},\ K_j \in L,\ j \leq m$ die Menge aller Disjunktionen der Prädikate aus L,\\
\textbf{N} := $\{NOT(N_1\ AND\ N_2\ AND\ ...\ AND\ N_l)\},\ l \in \mathbb{N},\ N_k\in\ L,\ k \leq l\}$\ die Menge der Negation aller Konjunktionen von Prädikaten aus L,\\
dann gilt $$body := A_1\ AND\ A_2\ AND\ ...\ A_N,\ N\in\mathbb{N},\ A_i\in \{L\vee\ K\vee\ N\},\ i \leq N$$


Ein Körper besteht in der Regel aus \texttt{AND} - Verknüpfungen von Literalen. Ein Literal kann allerdings selbst entweder eine \texttt{OR}-Verknüpfung aus Literalen sein \footnote{Diese \texttt{OR} - Verknüpfung muss in einer Klammer stehen und hat damit größere Bindung als die \texttt{AND}-Verknüpfungen. Ohne Klammer sind \texttt{OR}-Verbindungen nicht erlaubt, da man die Regel einfach in zwei Regeln aufteilen kann: $body=A_1\ AND\ A_2\ OR\ A_3\ AND\ A_4$ kann man schreiben als: $body1 =A_1\ AND\ A_2 $ und $body2=A_3\ AND\ A_4$} oder die Negation von \texttt{AND} - Verknüpfungen von Literalen.\\ 
Folgendes ist somit ein valides Beispiel:
$$body=B_1\ AND\ B_2\ AND\ (B_3\ OR\ B_4)\ AND\ NOT(B_5\ AND\ B_6),\ B_i\in\ L, i \leq 6$$

Um auch absolute Regeln aufstellen zu können, ist ein leerer Körper ebenfalls erlaubt. Die Regel tritt dann in jedem Fall in Kraft:

\begin{verbatim}
IF 
THEN role 'Azubi' cannot execute 'Kreditantrag prüfen'
\end{verbatim}
\begin{figure}[!h]
\small Die Aufgabe 'Kreditantrag prüfen' darf in keinem Fall von einem Azubi ausgeführt werden.
\caption{Absolute Regel mit einem leeren Körper}
\label{fig:absolute}
\end{figure}

Neben den eigentlichen Regeln kann man Regeln für selbst definierte Prädikate aufstellen. Dies wird im Abschnitt \ref{sec:define} genauer erläutert.

\section{Grammatik - Syntax und Semantik}
In diesem Abschnitt werden die wichtigsten Merkmale der Definitionssprache an Beispielen erläutert. Eine genaue Definition in \textbf{BNF}-Form \footnote{Backus-Naur-Format} befindet sich in Anhang \ref{Grammatik}.
\begin{verbatim}
DEF same_departement(UT, UT)

SET 'Erika Haas' is related to 'Stephan Heinzmann'
SET 'Erika Haas' is related to 'Tim Müller'
SET same_departemement('Erika Haas' , 'Stephan Heinzmann')

// Einzeiliger Kommentar
/*
Mehrzeiliger Kommentar
*/
DESC "Wenn zwei Mitarbeiter verwandt sind und in der selben Abteilung arbeiten,
dürfen sie nicht gemeinsam an 'T1' uns 'T2' arbeiten."
IF user USER_A executed 'T1' AND USER_A is related to USER_B 
AND same_departement(USER_A, USER_B)
THEN user USER_B cannot execute 'T2'
\end{verbatim}
\begin{figure}[!h]
\caption{Beispiel für die Definition von Regeln}
\label{fig:absolute}
\end{figure}

Zu Beginn einer Regel-Datei kann man eigene Prädikate definieren (siehe Abschnitt \ref{sec:define}). Als nächstes können Fakten aus Prädikaten in den Tabellen \ref{tab:extern} und \ref{tab:specification} und selbst definierten Prädikaten gesetzt werden (Abschnitt \ref{sec:set}). Im letzten Abschnitt werden die eigentlichen Regeln eingetragen (Abschnitt \ref{sec:rules}). Die drei Teile müssen in 
dieser Reihenfolge stattfinden und können nicht gemischt werden. 

%
% Erklärungen zur Grammatik
%

\subsection{Definition eigener Prädikate}
\label{sec:define}
Es kann nötig werden, eigene Prädikate zu definieren. Zum Beispiel, um weitere Personengruppen anzulegen oder um Abkürzungen für Zusammenhänge zu erstellen. Dafür gibt es die Möglichkeit, ein Prädikat mittels des Schlüsselwortes "DEF"\ zu Beginn der Regeldefinitionen zu setzen. In der Definition wird der Typ der Argumente festgelegt. Verfügbar sind 'UT', 'RT', 'TT', 'WT', 'TS', 'TP', 'NT' und 'STRING\_VAR'. 'STRING\_VAR' bezeichnet dabei einen beliebigen String.
Um die eigenen Prädikate nutzen zu können, muss man jedoch beachten, dass sie bei der Definition noch keinen 'Wert' haben. Entweder muss man sie dann mit 'SET'\ setzen oder man kann ihnen eine Regel erstellen. Damit die Prädikate für den Parser und die weitere Verarbeitung eindeutig sind, sind sie an eine spezielle Form gebunden: $<$predicatename$>$( ARGType (, ARGType)*). $<$predicatename$>$ kann nur aus Kleinbuchstaben a-z und Unterstrichen \_ (nicht am Anfang des Namens) bestehen.

\begin{verbatim}
DEF suspicious(UT)
DEF skipped(TT)
DEF aborted(UT,TT)

SET suspicous('Max Neuer')
SET suspicous('Tom Weisser')

IF EventType(ACTIVITY).'skipped' 
    THEN skipped(ACTIVITY)

IF user ACTOR executed ACTIVITY AND EventType(ACTIVITY).'aborted' 
    THEN aborted(ACTOR, ACTIVITY)
\end{verbatim}
\begin{figure}[!h]
\small Definition eigener Prädikate. \textit{suspicious} wird mit \texttt{SET} gesetzt. \textit{skipped} und \textit{aborted} erhalten eine Regel, wann sie gelten.
\caption{Definition eigener Prädikate.}
\label{fig:define}
\end{figure}

Die definierten Prädikate dienen nur zur Gruppierung von Nutzern oder Rollen bzw um Abkürzungen für Beziehungen zwischen Aktivitäten herzustellen. Sie werden bei der späteren Auswertung \textit{nicht} gegen die Logeinträge verglichen und sind somit nicht dazu geeignet, weitere Erwartungstypen zu definieren.

\subsection{Setzen von Fakten}
\label{sec:set}
Fakten aus den Tabellen \ref{tab:extern} (externe Informationen) und \ref{tab:specification} (Spezifikation des Prozesses) und selbst definierte Prädikate werden nach dem Definieren eigener Prädikate und vor dem Notieren der Regeln gesetzt. Fakten können keine Variablen enthalten.

\begin{verbatim}
SET 'Manager' dominates 'Sekretärin'
SET 'Tom Hoffman' belongs to role 'Administrator' 
\end{verbatim}
\begin{figure}[!h]
\small Spezifikation, dass die Rolle 'Manager' die 'Rolle' Sekretär dominiert sowie Zuweisung der Rolle 'Administrator' zu 'Tom Hoffman'.
\caption{Setzen von Fakten.}
\label{fig:define}
\end{figure}


\subsection{Notation bei Regeln}
\label{sec:rules}
Die Regeln repräsentieren die Einschränkungen, welche in einem Prozess gelten. Eine Regel besteht aus einem Kopf und einem Körper. Der Körper wird durch 'IF' und der Kopf durch 'THEN' eingeleitet. Bezüglich der Leerzeichen und Zeilenumbrüche exisitieren keine Einschränkungen. Insofern sie nicht direkt in einem Literal gesetzt werden, können sie an beliebiger Stelle platziert werden. Bei Literalen ist genau ein Leerzeichen zwischen den Wörtern einzuhalten. Abweichungen werden nicht toleriert.

Alle Klauseln (sowohl im Kopf als auch im Körper) können als Argumente entweder Konstanten oder Variablen enthalten. Konstanten sind entweder \textit{Strings} (dann müssen sie in jedem Fall von zwei einfach Anführungsstrichen umschlossen sein - zB 'Simon Pabst', 'start'), numerische Werte (Zahlen n $\geq$ 0), Zeitpunkte oder Zeitstempel (siehe Abschnitt \ref{sec:vars}). Variablen müssen mit einem Großbuchstaben beginnen. Dannach können sie alle Zeichen [A-Za-z0-9\_]enthalten. Es ist zu beachten, dass reservierte Schlüsselwörter als Variable nicht erlaubt sind (Abschnitt \ref{sec:keywords}). Werden die selben Variablen in unterschiedlichen Klauseln eingesetzt, dann entsprechen sie dem selben Wert. Unterschiedliche Variablen \textit{können} bei der Auswertung den selben Wert annehmen. Sollte es ausdrücklich gewünscht sein, unterschiedliche Werte für unterschiedliche Variablen zu erhalten, empfiehlt es sich, das Prädikat VAR != VAR zu setzen.

Die definierten Variablen gelten innerhalb einer Regel. Man kann die selben Variablen in verschiedenen Regeln verwenden, ohne dass sie sich auf den selben Wert beziehen müssen.

\begin{verbatim}
IF user A executed 'T1' AND user B executed 'T2' AND A != B
    THEN user A must execute 'T3'
\end{verbatim}
\begin{figure}[!h]
\caption{Unterschiedliche Werte für unterschiedliche Variablen}
\label{fig:diffvars}
\end{figure}

Zu einer Regel kann eine Beschreibung mittels \texttt{DESC "Beschreibung"} oberhalb der Regel hinzugefügt werden. Obwohl es nicht obligatorisch ist, wird es dennoch empfohlen, da diese Beschreibung bei der späteren Auswertung der Logs im Falle gefundener Regelverletzungen dem Ergebnis hinzugefügt wird, und es dem Anwender erleichtert, die Verletzungen den definierten Regeln zuzuordnen.

Es ist erforderlich zu beachten, dass Konsistenz in Bezug auf die Kontextspezifische Notation gilt (siehe Abschnitt \ref{sec:context} - Spezifikation des Kontexts). Es ist nicht erlaubt, verschiedene Notationen innerhalb einer Regel zu mischen. Die Regeln selbst dürfen allerdings verschiedene Geltungsbereiche besitzen.

\subsection{Spezifikation des Kontexts}
\label{sec:context}
Wie in Abschnitt \ref{sec:rulecontext} festgestellt, kann eine Regel drei Spannweiten der untersuchten Aktivitäten annehmen. Im \textit{Intra-Instance} Bereich werden Aktivitäten jeweils aus der selben Prozessinstanz betrachtet. Jede Prozessinstanz wird einzeln untersucht. Bei \textit{Inter-Instance} Regeln werden alle Aktivitäten aus aus dem selben Prozessschema mit einbezogen. Es wird nicht beachtet, aus welcher Instanz sie stammen. \textit{Inter-Process} Regeln betrachten alle Aktivitäten, unabhängig davon, zu welchem Prozessschema sie gehören.

Folgende Konventionen herrschen in der Notation, um den Kontext einer Regel zu definieren:

\textbf{Intra-Instance} Aktivitäten sind einfache Konstanten oder Variablen: \texttt{'Auftrag prüfen'} oder \texttt{Task\_A}

\textbf{Inter-Instance} Aktivitäten bestehen aus zwei Teilen:  $<$taskName$>$. $<$processInstance$>$. Sowohl $<$taskName$>$ als auch  $<$processInstance$>$ können unabhängig voneinander Variablen oder Konstanten sein: \texttt{Task\_A.PI\_1} oder \texttt{'Auftrag annehmen'.PI\_2}.

\textbf{Inter-Process} Aktivitäten sind dreiteilig:  $<$taskName$>$. $<$processName$>$. $<$processInstance$>$

\begin{verbatim}
// Intra-Instance - wenn Mark T1 ausführt, darf Tom nicht mehr an T3 arbeiten
IF user 'Mark' executed 'T1'
    THEN user 'Tom' must execute 'T3'

// Inter-Instance - ein Mitarbeiter darf höchstens 3 mal an T1 arbeiten
IF NUMBER WHERE user A executed 'T1'.TID_1 is N AND N > 3
    THEN user A cannot execute 'T1'.TID_2

// Inter-Process - ein Nutzer darf 'T3' höchstens 100 mal ausführen
IF NUMBER WHERE user A executed 'T3'.T_1.TID_1 is N AND N > 100
    THEN user A cannot execute 'T3'
\end{verbatim}
\begin{figure}[!h]
\caption{Beispiele für verschiedene Geltungsbereiche}
\label{fig:exampleinterinstance}
\end{figure}

\subsection{Events}
Obwohl es zu erhöhtem Aufwand führt, den Eventtyp zu den in einer Regel enthaltenen Aktivitäten explizit anzugeben, wurde beschlossen, den Eventtypen für Prädikate wie zB \\\texttt{user U executed T} oder auch \texttt{timestamp of T is N} offenzulassen, da somit größtmögliche Freiheit gewährleistet wird. 

Es gibt vier vordefinierte Prädikate, welche den Eventtyp ausdrücken: \texttt{ UT is assigned to TT},\\
\texttt{TT aborted}, \texttt{TT completed} und \texttt{TT started}. Für alle weiteren Events ist das allgemeine Prädikat \texttt{eventtype of TT is ET} zu verwenden.

Sollte der Eventtyp nicht angegeben werden, ist mit multiplen Ergebnissen zu rechnen, da für jede Aktivität jedes Event einzeln betrachtet wird. Weitere Nachteile entstehen dadurch nicht.

\subsection{Disjunktion}
\label{sec:disjunction}
Es wird wenige Fälle geben, in denen eine Disjunktion von Klauseln notwendig ist. Um besser nachvollziehen zu können, zu welchem Fall eine Regelverletzung gehört, ist es oft sogar sinnvoller, eine Regel, die mehrere Fälle erlaubt, auf mehrere Regeln aufzuteilen. Jedoch kann es verwendet werden, um Kardinalitätsaussagen einfacher darstellen zu können. Um die Stärke der Bindung deutlich zu machen, müssen Disjunktionen in einer Klammer stehen. Disjunktion ohne umgebende Klammern ist nicht erlaubt. Disjunktionen von Konjunktionstermen sind nicht erlaubt.

Beispiel: Anzahl an Rollen muss mindestens 2 sein, die an 3 Tasks gearbeitet haben.

\begin{verbatim}
IF (User executed 'task1' OR USER executed 'task2')
THEN User cannot execute 'task3'
\end{verbatim}
\begin{figure}[!h]
\caption{Disjunktion im Körper einer Regel. Man beachte, dass jede Disjunktion von umschließenden Klammern umgeben sein muss.}
\label{fig:disjunction1}
\end{figure}

Im Kopf einer Regel ist Disjunktion nicht erlaubt. Die Regel muss in zwei getrennte Regeln gespalten werden.

\begin{verbatim}
IF User executed 'task1'
THEN User cannot execute 'task2'

IF User executed 'task1'
THEN User cannot execute 'task3'
\end{verbatim}
\begin{figure}[!h]
\caption{Disjunktion im Kopfbereich ist nicht erlaubt. Es müssen zwei getrennte Regeln erstellt werden.}
\label{fig:disjunction2}
\end{figure}

\subsection{Kollaborateure und kritische Aufgabenpaare}
Die beiden Prädikate \texttt{UT is collaborator of UT} und \texttt{critical\_task\_pair(TT,TT)} gehören zueinander.
Kritische Aufgabenpaare müssen mit \texttt{SET} gesetzt werden. Kollaborateure sind Nutzerpaare, die an den kritischen Aufgabenpaaren gemeinsam gearbeitet haben.
\\\texttt{UT is collaborator of UT} muss vom Anwender \textit{nicht} exlipzit gesetzt werden, sondern wird intern im Analyseprogramm berechnet. 

\subsection{reservierte Schlüsselwörter}
\label{sec:keywords}
Variablen müssen immer mit einem Großbuchstaben beginnen. Folgende Schlüsselwörter sind jedoch nicht erlaubt:\\
 \textbf{SET, IF, THEN, NOT, AND, OR, DEF, DESC, UT, RT, TT, WT, TS, TP, NT, STRING\_VAR, WHERE}\\
Wörter, die mit \textbf{GENERATED} oder \textbf{RULEID} beginnen.

%
% Nochmal konkretes Beispiel
%
\section{Konkretes Beispiel}
Die Regeln in Abschnitt \ref{sec:exampleconstraints}  können mit der entwickelten Definitionssprache wie folgt ausgedrückt werden:\\
\color{red} TODO aktualisieren, wenn Programm fertig
\color{black}
\small
\begin{verbatim}
SET related, critical task pairs,...
SET critical_task_pair('T2', 'T3')

TODO sortieren, was zu welchem Kontext gehört.
// C1
DESC "T1 muss vom Kundenberater ausgeführt werden"
IF
    THEN role 'Kundenberater' must execute 'T1'

DESC "T6 muss vom Kundenberater ausgeführt werden."
IF
    THEN role 'Kundenberater' must execute 'T6'

// C2
DESC "T6 sollte 3 Tage nach T1 erfolgen"
IF 'T1' started AND timestamp of 'T1' is N1
  AND 'T6' started AND timestamp of 'T6' is N2
  AND N2 > ( N1 + P3D )
    THEN illegal execution

// C3 TODO funktioniert das hier überhaupt? Es muss sich immer auf einen Task beziehen
DESC "Ein Mitarbeiter darf pro Tag höchstens 100 Tasks bearbeiten"
IF NUMBER WHERE ( 
  user U executed Task_B 
  AND MIN OF X WHERE ( timestamp of Task_B IS X) IS N1
  AND MAX OF Y WHERE (timestamp of Task_B IS Y) IS N2 
  AND ( N2 - N1 ) = 1D ) 
IS N 
AND N > 100
    THEN user U cannot execute Task_B

// C4
DESC "T1 und T2 muss von verschiedenen Personen erledigt werden"
IF user U executed 'T1'
    THEN user U cannot execute 'T2'

DESC "T1 und T3 muss von verschiedenen Personen erledigt werden"
IF user U executed 'T1'
    THEN user U cannot execute 'T3'

// C5
DESC "T2 und T3 müssen von verschiedenen Personen erledigt werden"
IF user U executed 'T2' AND user U executed 'T3'
    THEN illegal execution

DESC "T3 muss vom Bank Manager durchgeführt werden"
IF
  role 'Manager' must execute 'T3'

// C6 TODO das passt auch nicht, oder doch?
IF NUMBER WHERE (user U executed T AND T aborted ) IS N
  AND N > 5
  THEN user U cannot execute T

// C7
DESC "Es dürfen keine Anträge von Verwandten bearbeitet werden"
IF user U executed T AND attribute 'customer' of T is C
  AND U is related to C
  THEN illegal execution

// C8 TODO
DESC "Mitarbeiter dürfen höchstens 3 mal gemeinsam an T2 und T3 arbeiten"
IF user U1 executed 'T2' AND NUMBER WHERE (U1 is collaborator of U2) IS N
  THEN U2 cannot execute 'T3'

// C9
DESC "Ein Mitarbeiter darf bei dem selben Kunden höchstens Kredite
bis 100000 Euro prüfen"
IF SUM OF X WHERE (
  user U executed 'Antrag prüfen'.P1 
  AND 'Antrag prüfen'.P1 completed 
  AND attribute 'loanamount' OF T.P1 is X 
) IS N
AND N > 100000
    THEN user U cannot execute 'Antrag prüfen'.P2
\end{verbatim}
\begin{figure}[!h]
\caption{Regeln für unsere gefundenen Beispiele}
\label{fig:resultrulefile}
\end{figure}
\normalsize
